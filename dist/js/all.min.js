'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Tent = function Tent(name, price, length, width, minPersons, maxPersons) {
  _classCallCheck(this, Tent);

  this.name = name;
  this.price = price;
  this.length = length;
  this.width = width;
  this.minPersons = minPersons;
  this.maxPersons = maxPersons;
  this.squareMeter = this.length * this.width;
};

var Equipment = function Equipment(title, price, description) {
  _classCallCheck(this, Equipment);

  this.title = title;
  this.price = price;
  this.description = description;
};

var tents = [new Tent('Ein riesen grosses Zelt für alle', 15, 4, 20, 100, 150), new Tent('Grosses Zelt', 30, 8, 20, 200, 300), new Tent('Grosses Zelt', 50, 12, 20, 150, 300)];

var equipments = [new Equipment('Lampe', 5, 'kleine Lampe für das DJ Pult'), new Equipment('Bodenplatte 30x30 cm', 2, 'Um den Boden zu schützen'), new Equipment('Tisch - 3 Meter ', 9, "für 6 Personen"), new Equipment('Tisch - 5 Meter ', 9, "für 9 Personen")];

var WizardStep = function () {
  function WizardStep() {
    var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
    var wizardForm = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

    _classCallCheck(this, WizardStep);

    this.name = name;
    this.active = ko.observable(false);
    this.activeSubStep = ko.observable();
    this.wizardForm = wizardForm;
    this.isVisible = ko.computed(function () {
      return this.active() && !this.activeSubStep();
    }, this);
  }

  _createClass(WizardStep, [{
    key: 'openSubStep',
    value: function openSubStep(substep) {
      substep.active(true);
      this.activeSubStep(substep);
    }
  }, {
    key: 'closeSubStep',
    value: function closeSubStep() {
      this.activeSubStep().active(false);
      this.activeSubStep(null);
    }
  }, {
    key: 'removeDataRow',
    value: function removeDataRow() {
      throw new Error('Override this function');
    }
  }]);

  return WizardStep;
}();

var WizardSubStep = function (_WizardStep) {
  _inherits(WizardSubStep, _WizardStep);

  function WizardSubStep(parent) {
    var _ref;

    _classCallCheck(this, WizardSubStep);

    for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
      args[_key - 1] = arguments[_key];
    }

    var _this = _possibleConstructorReturn(this, (_ref = WizardSubStep.__proto__ || Object.getPrototypeOf(WizardSubStep)).call.apply(_ref, [this].concat(args)));

    _this.parent = parent;
    _this.isVisible = ko.computed(function () {
      return this.active() && this.parent.active();
    }, _this);
    return _this;
  }

  return WizardSubStep;
}(WizardStep);

var WizardStepTents = function (_WizardStep2) {
  _inherits(WizardStepTents, _WizardStep2);

  function WizardStepTents() {
    var _ref2;

    _classCallCheck(this, WizardStepTents);

    for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
      args[_key2] = arguments[_key2];
    }

    var _this2 = _possibleConstructorReturn(this, (_ref2 = WizardStepTents.__proto__ || Object.getPrototypeOf(WizardStepTents)).call.apply(_ref2, [this].concat(args)));

    _this2.selectTentsSubStep = new WizardStepSelectTents(_this2);
    _this2.openSubStep(_this2.selectTentsSubStep);
    return _this2;
  }

  _createClass(WizardStepTents, [{
    key: 'openSelectTent',
    value: function openSelectTent() {
      this.openSubStep(this.selectTentsSubStep);
    }
  }, {
    key: 'removeDataRow',
    value: function removeDataRow(tent) {
      this.wizardForm.selectedTents.remove(tent);
    }
  }]);

  return WizardStepTents;
}(WizardStep);

var WizardStepEquipments = function (_WizardStep3) {
  _inherits(WizardStepEquipments, _WizardStep3);

  function WizardStepEquipments() {
    var _ref3;

    _classCallCheck(this, WizardStepEquipments);

    for (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
      args[_key3] = arguments[_key3];
    }

    var _this3 = _possibleConstructorReturn(this, (_ref3 = WizardStepEquipments.__proto__ || Object.getPrototypeOf(WizardStepEquipments)).call.apply(_ref3, [this].concat(args)));

    _this3.selectEquipmentSubStep = new WizardStepSelectEquipment(_this3);
    _this3.openSubStep(_this3.selectEquipmentSubStep);
    return _this3;
  }

  _createClass(WizardStepEquipments, [{
    key: 'openSelectEquipment',
    value: function openSelectEquipment() {
      this.openSubStep(this.selectEquipmentSubStep);
    }
  }, {
    key: 'removeDataRow',
    value: function removeDataRow(equipment) {
      this.wizardForm.selectedEquipments.remove(equipment);
    }
  }]);

  return WizardStepEquipments;
}(WizardStep);

var WizardStepContact = function (_WizardStep4) {
  _inherits(WizardStepContact, _WizardStep4);

  function WizardStepContact() {
    var _ref4;

    _classCallCheck(this, WizardStepContact);

    for (var _len4 = arguments.length, args = Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
      args[_key4] = arguments[_key4];
    }

    var _this4 = _possibleConstructorReturn(this, (_ref4 = WizardStepContact.__proto__ || Object.getPrototypeOf(WizardStepContact)).call.apply(_ref4, [this].concat(args)));

    _this4.availableGenders = ko.observableArray(['Bitte auswählen...', 'Herr', 'Frau']);
    _this4.validLastName = ko.observable(true);
    return _this4;
  }

  _createClass(WizardStepContact, [{
    key: 'validateLastName',
    value: function validateLastName() {
      this.validLastName(false);
    }
  }]);

  return WizardStepContact;
}(WizardStep);

var WizardStepSelectTents = function (_WizardSubStep) {
  _inherits(WizardStepSelectTents, _WizardSubStep);

  function WizardStepSelectTents(parent) {
    var _ref5;

    _classCallCheck(this, WizardStepSelectTents);

    for (var _len5 = arguments.length, args = Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {
      args[_key5 - 1] = arguments[_key5];
    }

    return _possibleConstructorReturn(this, (_ref5 = WizardStepSelectTents.__proto__ || Object.getPrototypeOf(WizardStepSelectTents)).call.apply(_ref5, [this, parent].concat(args)));
  }

  _createClass(WizardStepSelectTents, [{
    key: 'selectTent',
    value: function selectTent(tent) {
      this.parent.wizardForm.selectedTents.push(Object.assign(new Tent(), tent));
      this.parent.closeSubStep();
    }
  }]);

  return WizardStepSelectTents;
}(WizardSubStep);

var WizardStepSelectEquipment = function (_WizardSubStep2) {
  _inherits(WizardStepSelectEquipment, _WizardSubStep2);

  function WizardStepSelectEquipment() {
    _classCallCheck(this, WizardStepSelectEquipment);

    return _possibleConstructorReturn(this, (WizardStepSelectEquipment.__proto__ || Object.getPrototypeOf(WizardStepSelectEquipment)).apply(this, arguments));
  }

  _createClass(WizardStepSelectEquipment, [{
    key: 'selectEquipment',
    value: function selectEquipment(equipment) {
      this.parent.wizardForm.selectedEquipments.push(Object.assign(new Equipment(), equipment));
      this.parent.closeSubStep();
    }
  }]);

  return WizardStepSelectEquipment;
}(WizardSubStep);

var WizardForm = function () {
  function WizardForm() {
    _classCallCheck(this, WizardForm);

    this.firstName = ko.observable();
    this.lastName = ko.observable();
    this.salutation = ko.observable();
    this.company = ko.observable();
    this.street = ko.observable();
    this.streetnr = ko.observable();
    this.zip = ko.observable();
    this.location = ko.observable();
    this.email = ko.observable();
    this.phone = ko.observable();

    this.tents = ko.observableArray(tents.sort(function (a, b) {
      return a.minPersons - b.minPersons;
    }));
    this.equipments = ko.observableArray(equipments);
    this.selectedTents = ko.observableArray();
    this.selectedEquipments = ko.observableArray();
    this.totalTentsPrice = ko.computed(function () {
      return this._count_objs_attribute(this.selectedTents(), 'price');
    }, this);
    this.totalEquipmentsPrice = ko.computed(function () {
      return this._count_objs_attribute(this.selectedEquipments(), 'price');
    }, this);
    this.totalPrice = ko.computed(function () {
      return this.totalTentsPrice() + this.totalEquipmentsPrice();
    }, this);
    this.totalMinPersons = ko.computed(function () {
      return this._count_objs_attribute(this.selectedTents(), 'minPersons');
    }, this);
    this.totalMaxPersons = ko.computed(function () {
      return this._count_objs_attribute(this.selectedTents(), 'maxPersons');
    }, this);
    this.totalSquareMeters = ko.computed(function () {
      return this._count_objs_attribute(this.selectedTents(), 'squareMeter');
    }, this);
  }

  _createClass(WizardForm, [{
    key: '_count_objs_attribute',
    value: function _count_objs_attribute(objs, attr) {
      var total = 0;
      objs.forEach(function (obj) {
        total += obj[attr];
      });
      return total;
    }
  }]);

  return WizardForm;
}();

var Wizard = function () {
  function Wizard() {
    _classCallCheck(this, Wizard);

    this.form = new WizardForm();
    // 0 = Fillout, 1 = Success, 2 = Error
    this.mode = ko.observable(0);
    this.steps = ko.observableArray([new WizardStepTents('Zelt', this.form), new WizardStepEquipments('Zubehör', this.form), new WizardStepContact('Kontakt', this.form)]);
    this.currentStep = ko.observable(this.steps()[0]);
    this.showPrevButton = ko.computed(function () {
      return this.currentWizardStepId() > 0;
    }, this);
    this.showNextButton = ko.computed(function () {
      return this.currentWizardStepId() < this.steps().length - 1;
    }, this);
    this.showSendButton = ko.computed(function () {
      return this.currentWizardStepId() == this.steps().length - 1;
    }, this);

    ko.computed(function () {
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = this.steps()[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var step = _step.value;

          step.active(false);
          if (this.currentStep() == step) {
            step.active(true);
          }
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }
    }, this);
  }

  _createClass(Wizard, [{
    key: 'next',
    value: function next() {
      this.currentStep(this.steps()[this.currentWizardStepId() + 1]);
    }
  }, {
    key: 'previous',
    value: function previous() {
      this.currentStep(this.steps()[this.currentWizardStepId() - 1]);
    }
  }, {
    key: 'send',
    value: function send() {
      var data = {
        action: 'kah_send_tent_configurator',
        firstName: this.form.firstName(),
        lastName: this.form.lastName(),
        salutation: this.form.salutation(),
        company: this.form.company(),
        street: this.form.street(),
        streetnr: this.form.streetnr(),
        zip: this.form.zip(),
        location: this.form.location(),
        email: this.form.email(),
        phone: this.form.phone(),
        selectedTents: this.form.selectedTents(),
        selectedEquipments: this.form.selectedEquipments(),
        totalTentsPrice: this.form.totalTentsPrice(),
        totalEquipmentsPrice: this.form.totalEquipmentsPrice(),
        totalPrice: this.form.totalPrice(),
        totalMinPersons: this.form.totalMinPersons(),
        totalMaxPersons: this.form.totalMaxPersons(),
        totalSquareMeters: this.form.totalSquareMeters()
      };
      var ajaxurl = "http://localhost:8888/wp-admin/admin-ajax.php";
      jQuery.post(ajaxurl, data).done(function (self) {
        return function () {
          self.mode(1);
        };
      }(this)).fail(function (self) {
        return function () {
          self.mode(2);
        };
      }(this)).always(function () {
        jQuery(window).scrollTop(0);
      });
    }
  }, {
    key: 'readablePrice',
    value: function readablePrice(price) {
      return price + ' CHF';
    }
  }, {
    key: 'readablePersons',
    value: function readablePersons(minPersons, maxPersons) {
      return minPersons + ' - ' + maxPersons + ' Personen';
    }
  }, {
    key: 'currentWizardStepId',
    value: function currentWizardStepId() {
      return this.steps().indexOf(this.currentStep());
    }
  }]);

  return Wizard;
}();

jQuery(document).ready(function () {
  ko.applyBindings(new Wizard(), document.getElementById('wizard-form'));
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiVGVudCIsIm5hbWUiLCJwcmljZSIsImxlbmd0aCIsIndpZHRoIiwibWluUGVyc29ucyIsIm1heFBlcnNvbnMiLCJzcXVhcmVNZXRlciIsIkVxdWlwbWVudCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJ0ZW50cyIsImVxdWlwbWVudHMiLCJXaXphcmRTdGVwIiwid2l6YXJkRm9ybSIsImFjdGl2ZSIsImtvIiwib2JzZXJ2YWJsZSIsImFjdGl2ZVN1YlN0ZXAiLCJpc1Zpc2libGUiLCJjb21wdXRlZCIsInN1YnN0ZXAiLCJFcnJvciIsIldpemFyZFN1YlN0ZXAiLCJwYXJlbnQiLCJhcmdzIiwiV2l6YXJkU3RlcFRlbnRzIiwic2VsZWN0VGVudHNTdWJTdGVwIiwiV2l6YXJkU3RlcFNlbGVjdFRlbnRzIiwib3BlblN1YlN0ZXAiLCJ0ZW50Iiwic2VsZWN0ZWRUZW50cyIsInJlbW92ZSIsIldpemFyZFN0ZXBFcXVpcG1lbnRzIiwic2VsZWN0RXF1aXBtZW50U3ViU3RlcCIsIldpemFyZFN0ZXBTZWxlY3RFcXVpcG1lbnQiLCJlcXVpcG1lbnQiLCJzZWxlY3RlZEVxdWlwbWVudHMiLCJXaXphcmRTdGVwQ29udGFjdCIsImF2YWlsYWJsZUdlbmRlcnMiLCJvYnNlcnZhYmxlQXJyYXkiLCJ2YWxpZExhc3ROYW1lIiwicHVzaCIsIk9iamVjdCIsImFzc2lnbiIsImNsb3NlU3ViU3RlcCIsIldpemFyZEZvcm0iLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsInNhbHV0YXRpb24iLCJjb21wYW55Iiwic3RyZWV0Iiwic3RyZWV0bnIiLCJ6aXAiLCJsb2NhdGlvbiIsImVtYWlsIiwicGhvbmUiLCJzb3J0IiwiYSIsImIiLCJ0b3RhbFRlbnRzUHJpY2UiLCJfY291bnRfb2Jqc19hdHRyaWJ1dGUiLCJ0b3RhbEVxdWlwbWVudHNQcmljZSIsInRvdGFsUHJpY2UiLCJ0b3RhbE1pblBlcnNvbnMiLCJ0b3RhbE1heFBlcnNvbnMiLCJ0b3RhbFNxdWFyZU1ldGVycyIsIm9ianMiLCJhdHRyIiwidG90YWwiLCJmb3JFYWNoIiwib2JqIiwiV2l6YXJkIiwiZm9ybSIsIm1vZGUiLCJzdGVwcyIsImN1cnJlbnRTdGVwIiwic2hvd1ByZXZCdXR0b24iLCJjdXJyZW50V2l6YXJkU3RlcElkIiwic2hvd05leHRCdXR0b24iLCJzaG93U2VuZEJ1dHRvbiIsInN0ZXAiLCJkYXRhIiwiYWN0aW9uIiwiYWpheHVybCIsImpRdWVyeSIsInBvc3QiLCJkb25lIiwic2VsZiIsImZhaWwiLCJhbHdheXMiLCJ3aW5kb3ciLCJzY3JvbGxUb3AiLCJpbmRleE9mIiwiZG9jdW1lbnQiLCJyZWFkeSIsImFwcGx5QmluZGluZ3MiLCJnZXRFbGVtZW50QnlJZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztJQUFNQSxPQUNKLGNBQVlDLElBQVosRUFBa0JDLEtBQWxCLEVBQXlCQyxNQUF6QixFQUFpQ0MsS0FBakMsRUFBd0NDLFVBQXhDLEVBQW9EQyxVQUFwRCxFQUFnRTtBQUFBOztBQUM5RCxPQUFLTCxJQUFMLEdBQVlBLElBQVo7QUFDQSxPQUFLQyxLQUFMLEdBQWFBLEtBQWI7QUFDQSxPQUFLQyxNQUFMLEdBQWNBLE1BQWQ7QUFDQSxPQUFLQyxLQUFMLEdBQWFBLEtBQWI7QUFDQSxPQUFLQyxVQUFMLEdBQWtCQSxVQUFsQjtBQUNBLE9BQUtDLFVBQUwsR0FBa0JBLFVBQWxCO0FBQ0EsT0FBS0MsV0FBTCxHQUFtQixLQUFLSixNQUFMLEdBQWMsS0FBS0MsS0FBdEM7QUFDRDs7SUFHR0ksWUFDSixtQkFBWUMsS0FBWixFQUFtQlAsS0FBbkIsRUFBMEJRLFdBQTFCLEVBQXVDO0FBQUE7O0FBQ3JDLE9BQUtELEtBQUwsR0FBYUEsS0FBYjtBQUNBLE9BQUtQLEtBQUwsR0FBYUEsS0FBYjtBQUNBLE9BQUtRLFdBQUwsR0FBbUJBLFdBQW5CO0FBQ0Q7O0FBR0gsSUFBSUMsUUFBUSxDQUNWLElBQUlYLElBQUosQ0FBUyxrQ0FBVCxFQUE2QyxFQUE3QyxFQUFpRCxDQUFqRCxFQUFvRCxF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dGVudCI6WyJjbGFzcyBUZW50IHtcbiAgY29uc3RydWN0b3IobmFtZSwgcHJpY2UsIGxlbmd0aCwgd2lkdGgsIG1pblBlcnNvbnMsIG1heFBlcnNvbnMpIHtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMucHJpY2UgPSBwcmljZTtcbiAgICB0aGlzLmxlbmd0aCA9IGxlbmd0aDtcbiAgICB0aGlzLndpZHRoID0gd2lkdGg7XG4gICAgdGhpcy5taW5QZXJzb25zID0gbWluUGVyc29ucztcbiAgICB0aGlzLm1heFBlcnNvbnMgPSBtYXhQZXJzb25zO1xuICAgIHRoaXMuc3F1YXJlTWV0ZXIgPSB0aGlzLmxlbmd0aCAqIHRoaXMud2lkdGg7XG4gIH1cbn1cblxuY2xhc3MgRXF1aXBtZW50IHtcbiAgY29uc3RydWN0b3IodGl0bGUsIHByaWNlLCBkZXNjcmlwdGlvbikge1xuICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICB0aGlzLnByaWNlID0gcHJpY2U7IFxuICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgfVxufVxuXG52YXIgdGVudHMgPSBbXG4gIG5ldyBUZW50KCdFaW4gcmllc2VuIGdyb3NzZXMgWmVsdCBmw7xyIGFsbGUnLCAxNSwgNCwgMjAsIDEwMCwgMTUwKSxcbiAgbmV3IFRlbnQoJ0dyb3NzZXMgWmVsdCcsIDMwLCA4LCAyMCwgMjAwLCAzMDApLFxuICBuZXcgVGVudCgnR3Jvc3NlcyBaZWx0JywgNTAsIDEyLCAyMCwgMTUwLCAzMDApLFxuXTtcblxudmFyIGVxdWlwbWVudHMgPSBbXG4gIG5ldyBFcXVpcG1lbnQoJ0xhbXBlJywgNSwgJ2tsZWluZSBMYW1wZSBmw7xyIGRhcyBESiBQdWx0JyksXG4gIG5ldyBFcXVpcG1lbnQoJ0JvZGVucGxhdHRlIDMweDMwIGNtJywgMiwgJ1VtIGRlbiBCb2RlbiB6dSBzY2jDvHR6ZW4nKSxcbiAgbmV3IEVxdWlwbWVudCgnVGlzY2ggLSAzIE1ldGVyICcsIDksIFwiZsO8ciA2IFBlcnNvbmVuXCIpLFxuICBuZXcgRXF1aXBtZW50KCdUaXNjaCAtIDUgTWV0ZXIgJywgOSwgXCJmw7xyIDkgUGVyc29uZW5cIilcbl07XG5cbmNsYXNzIFdpemFyZFN0ZXAge1xuICBjb25zdHJ1Y3RvcihuYW1lPScnLCB3aXphcmRGb3JtPW51bGwpIHtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMuYWN0aXZlID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7XG4gICAgdGhpcy5hY3RpdmVTdWJTdGVwID0ga28ub2JzZXJ2YWJsZSgpO1xuICAgIHRoaXMud2l6YXJkRm9ybSA9IHdpemFyZEZvcm07XG4gICAgdGhpcy5pc1Zpc2libGUgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLmFjdGl2ZSgpICYmICF0aGlzLmFjdGl2ZVN1YlN0ZXAoKTtcbiAgICB9LCB0aGlzKTtcbiAgfVxuICBvcGVuU3ViU3RlcChzdWJzdGVwKSB7XG4gICAgc3Vic3RlcC5hY3RpdmUodHJ1ZSk7XG4gICAgdGhpcy5hY3RpdmVTdWJTdGVwKHN1YnN0ZXApO1xuICB9XG4gIGNsb3NlU3ViU3RlcCgpIHtcbiAgICB0aGlzLmFjdGl2ZVN1YlN0ZXAoKS5hY3RpdmUoZmFsc2UpO1xuICAgIHRoaXMuYWN0aXZlU3ViU3RlcChudWxsKTtcbiAgfVxuICByZW1vdmVEYXRhUm93KCkgeyB0aHJvdyBuZXcgRXJyb3IoJ092ZXJyaWRlIHRoaXMgZnVuY3Rpb24nKTsgfVxufVxuXG5jbGFzcyBXaXphcmRTdWJTdGVwIGV4dGVuZHMgV2l6YXJkU3RlcCB7XG4gIGNvbnN0cnVjdG9yKHBhcmVudCwgLi4uYXJncykge1xuICAgIHN1cGVyKC4uLmFyZ3MpO1xuICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICAgIHRoaXMuaXNWaXNpYmxlID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5hY3RpdmUoKSAmJiB0aGlzLnBhcmVudC5hY3RpdmUoKTtcbiAgICB9LCB0aGlzKTtcbiAgfVxufVxuY2xhc3MgV2l6YXJkU3RlcFRlbnRzIGV4dGVuZHMgV2l6YXJkU3RlcCB7XG4gIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHtcbiAgICBzdXBlciguLi5hcmdzKTtcbiAgICB0aGlzLnNlbGVjdFRlbnRzU3ViU3RlcCA9IG5ldyBXaXphcmRTdGVwU2VsZWN0VGVudHModGhpcyk7XG4gICAgdGhpcy5vcGVuU3ViU3RlcCh0aGlzLnNlbGVjdFRlbnRzU3ViU3RlcCk7XG4gIH1cbiAgb3BlblNlbGVjdFRlbnQoKSB7XG4gICAgdGhpcy5vcGVuU3ViU3RlcCh0aGlzLnNlbGVjdFRlbnRzU3ViU3RlcCk7XG4gIH1cbiAgcmVtb3ZlRGF0YVJvdyh0ZW50KSB7XG4gICAgdGhpcy53aXphcmRGb3JtLnNlbGVjdGVkVGVudHMucmVtb3ZlKHRlbnQpO1xuICB9XG59XG5cbmNsYXNzIFdpemFyZFN0ZXBFcXVpcG1lbnRzIGV4dGVuZHMgV2l6YXJkU3RlcCB7XG4gIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHtcbiAgICBzdXBlciguLi5hcmdzKTtcbiAgICB0aGlzLnNlbGVjdEVxdWlwbWVudFN1YlN0ZXAgPSBuZXcgV2l6YXJkU3RlcFNlbGVjdEVxdWlwbWVudCh0aGlzKTtcbiAgICB0aGlzLm9wZW5TdWJTdGVwKHRoaXMuc2VsZWN0RXF1aXBtZW50U3ViU3RlcCk7XG4gIH1cbiAgb3BlblNlbGVjdEVxdWlwbWVudCgpIHtcbiAgICB0aGlzLm9wZW5TdWJTdGVwKHRoaXMuc2VsZWN0RXF1aXBtZW50U3ViU3RlcCk7XG4gIH1cbiAgcmVtb3ZlRGF0YVJvdyhlcXVpcG1lbnQpIHtcbiAgICB0aGlzLndpemFyZEZvcm0uc2VsZWN0ZWRFcXVpcG1lbnRzLnJlbW92ZShlcXVpcG1lbnQpO1xuICB9IFxufVxuXG5jbGFzcyBXaXphcmRTdGVwQ29udGFjdCBleHRlbmRzIFdpemFyZFN0ZXAge1xuICBjb25zdHJ1Y3RvciguLi5hcmdzKSB7XG4gICAgc3VwZXIoLi4uYXJncyk7XG4gICAgdGhpcy5hdmFpbGFibGVHZW5kZXJzID0ga28ub2JzZXJ2YWJsZUFycmF5KFsnQml0dGUgYXVzd8OkaGxlbi4uLicsICdIZXJyJywgJ0ZyYXUnXSk7XG4gICAgdGhpcy52YWxpZExhc3ROYW1lID0ga28ub2JzZXJ2YWJsZSh0cnVlKTtcbiAgfVxuICB2YWxpZGF0ZUxhc3ROYW1lKCkge1xuICAgIHRoaXMudmFsaWRMYXN0TmFtZShmYWxzZSk7XG4gIH1cbn1cblxuY2xhc3MgV2l6YXJkU3RlcFNlbGVjdFRlbnRzIGV4dGVuZHMgV2l6YXJkU3ViU3RlcCB7XG4gIGNvbnN0cnVjdG9yKHBhcmVudCwgLi4uYXJncykge1xuICAgIHN1cGVyKHBhcmVudCwgLi4uYXJncyk7XG4gIH1cbiAgc2VsZWN0VGVudCh0ZW50KSB7XG4gICAgdGhpcy5wYXJlbnQud2l6YXJkRm9ybS5zZWxlY3RlZFRlbnRzLnB1c2goT2JqZWN0LmFzc2lnbihuZXcgVGVudCgpLCB0ZW50KSk7XG4gICAgdGhpcy5wYXJlbnQuY2xvc2VTdWJTdGVwKCk7XG4gIH1cbn1cblxuY2xhc3MgV2l6YXJkU3RlcFNlbGVjdEVxdWlwbWVudCBleHRlbmRzIFdpemFyZFN1YlN0ZXAge1xuICBzZWxlY3RFcXVpcG1lbnQoZXF1aXBtZW50KSB7XG4gICAgdGhpcy5wYXJlbnQud2l6YXJkRm9ybS5zZWxlY3RlZEVxdWlwbWVudHMucHVzaChPYmplY3QuYXNzaWduKG5ldyBFcXVpcG1lbnQoKSwgZXF1aXBtZW50KSk7XG4gICAgdGhpcy5wYXJlbnQuY2xvc2VTdWJTdGVwKCk7XG4gIH1cbn1cbmNsYXNzIFdpemFyZEZvcm0ge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmZpcnN0TmFtZSA9IGtvLm9ic2VydmFibGUoKTtcbiAgICB0aGlzLmxhc3ROYW1lID0ga28ub2JzZXJ2YWJsZSgpO1xuICAgIHRoaXMuc2FsdXRhdGlvbiA9IGtvLm9ic2VydmFibGUoKTtcbiAgICB0aGlzLmNvbXBhbnkgPSBrby5vYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5zdHJlZXQgPSBrby5vYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5zdHJlZXRuciA9IGtvLm9ic2VydmFibGUoKTtcbiAgICB0aGlzLnppcCA9IGtvLm9ic2VydmFibGUoKTtcbiAgICB0aGlzLmxvY2F0aW9uID0ga28ub2JzZXJ2YWJsZSgpO1xuICAgIHRoaXMuZW1haWwgPSBrby5vYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5waG9uZSA9IGtvLm9ic2VydmFibGUoKTtcblxuICAgIHRoaXMudGVudHMgPSBrby5vYnNlcnZhYmxlQXJyYXkodGVudHMuc29ydCgoYSwgYikgPT4gYS5taW5QZXJzb25zIC0gYi5taW5QZXJzb25zKSk7XG4gICAgdGhpcy5lcXVpcG1lbnRzID0ga28ub2JzZXJ2YWJsZUFycmF5KGVxdWlwbWVudHMpO1xuICAgIHRoaXMuc2VsZWN0ZWRUZW50cyA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xuICAgIHRoaXMuc2VsZWN0ZWRFcXVpcG1lbnRzID0ga28ub2JzZXJ2YWJsZUFycmF5KCk7XG4gICAgdGhpcy50b3RhbFRlbnRzUHJpY2UgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLl9jb3VudF9vYmpzX2F0dHJpYnV0ZSh0aGlzLnNlbGVjdGVkVGVudHMoKSwgJ3ByaWNlJyk7XG4gICAgfSwgdGhpcyk7XG4gICAgdGhpcy50b3RhbEVxdWlwbWVudHNQcmljZSA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NvdW50X29ianNfYXR0cmlidXRlKHRoaXMuc2VsZWN0ZWRFcXVpcG1lbnRzKCksICdwcmljZScpO1xuICAgIH0sIHRoaXMpO1xuICAgIHRoaXMudG90YWxQcmljZSA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMudG90YWxUZW50c1ByaWNlKCkgKyB0aGlzLnRvdGFsRXF1aXBtZW50c1ByaWNlKCk7XG4gICAgfSwgdGhpcyk7XG4gICAgdGhpcy50b3RhbE1pblBlcnNvbnMgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLl9jb3VudF9vYmpzX2F0dHJpYnV0ZSh0aGlzLnNlbGVjdGVkVGVudHMoKSwgJ21pblBlcnNvbnMnKTtcbiAgICB9LCB0aGlzKTtcbiAgICB0aGlzLnRvdGFsTWF4UGVyc29ucyA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NvdW50X29ianNfYXR0cmlidXRlKHRoaXMuc2VsZWN0ZWRUZW50cygpLCAnbWF4UGVyc29ucycpO1xuICAgIH0sIHRoaXMpO1xuICAgIHRoaXMudG90YWxTcXVhcmVNZXRlcnMgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLl9jb3VudF9vYmpzX2F0dHJpYnV0ZSh0aGlzLnNlbGVjdGVkVGVudHMoKSwgJ3NxdWFyZU1ldGVyJyk7XG4gICAgfSwgdGhpcyk7XG4gIH1cbiAgX2NvdW50X29ianNfYXR0cmlidXRlKG9ianMsIGF0dHIpIHtcbiAgICBsZXQgdG90YWwgPSAwO1xuICAgIG9ianMuZm9yRWFjaChmdW5jdGlvbihvYmopIHsgdG90YWwgKz0gb2JqW2F0dHJdOyB9KTtcbiAgICByZXR1cm4gdG90YWw7XG4gIH1cbn1cblxuY2xhc3MgV2l6YXJkIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5mb3JtID0gbmV3IFdpemFyZEZvcm0oKTtcbiAgICAvLyAwID0gRmlsbG91dCwgMSA9IFN1Y2Nlc3MsIDIgPSBFcnJvclxuICAgIHRoaXMubW9kZSA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgdGhpcy5zdGVwcyA9IGtvLm9ic2VydmFibGVBcnJheShbXG4gICAgICBuZXcgV2l6YXJkU3RlcFRlbnRzKCdaZWx0JywgdGhpcy5mb3JtKSxcbiAgICAgIG5ldyBXaXphcmRTdGVwRXF1aXBtZW50cygnWnViZWjDtnInLCB0aGlzLmZvcm0pLFxuICAgICAgbmV3IFdpemFyZFN0ZXBDb250YWN0KCdLb250YWt0JywgdGhpcy5mb3JtKVxuICAgIF0pO1xuICAgIHRoaXMuY3VycmVudFN0ZXAgPSBrby5vYnNlcnZhYmxlKHRoaXMuc3RlcHMoKVswXSk7XG4gICAgdGhpcy5zaG93UHJldkJ1dHRvbiA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFdpemFyZFN0ZXBJZCgpID4gMDtcbiAgICB9LCB0aGlzKTtcbiAgICB0aGlzLnNob3dOZXh0QnV0dG9uID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5jdXJyZW50V2l6YXJkU3RlcElkKCkgPCAodGhpcy5zdGVwcygpLmxlbmd0aCAtMSk7XG4gICAgfSwgdGhpcyk7XG4gICAgdGhpcy5zaG93U2VuZEJ1dHRvbiA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFdpemFyZFN0ZXBJZCgpID09IHRoaXMuc3RlcHMoKS5sZW5ndGggLTE7XG4gICAgfSwgdGhpcyk7XG4gICAgXG4gICAga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICBmb3IgKGxldCBzdGVwIG9mIHRoaXMuc3RlcHMoKSkge1xuICAgICAgICBzdGVwLmFjdGl2ZShmYWxzZSk7XG4gICAgICAgIGlmICggdGhpcy5jdXJyZW50U3RlcCgpID09IHN0ZXAgKSB7XG4gICAgICAgICAgc3RlcC5hY3RpdmUodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LCB0aGlzKTtcbiAgfVxuICBuZXh0KCkge1xuICAgIHRoaXMuY3VycmVudFN0ZXAodGhpcy5zdGVwcygpW3RoaXMuY3VycmVudFdpemFyZFN0ZXBJZCgpICsgMV0pO1xuICB9XG4gIHByZXZpb3VzKCkge1xuICAgIHRoaXMuY3VycmVudFN0ZXAodGhpcy5zdGVwcygpW3RoaXMuY3VycmVudFdpemFyZFN0ZXBJZCgpIC0xXSk7XG4gIH1cbiAgc2VuZCgpIHtcbiAgICB2YXIgZGF0YSA9IHtcbiAgICAgIGFjdGlvbjogJ2thaF9zZW5kX3RlbnRfY29uZmlndXJhdG9yJyxcbiAgICAgIGZpcnN0TmFtZTogdGhpcy5mb3JtLmZpcnN0TmFtZSgpLFxuICAgICAgbGFzdE5hbWU6IHRoaXMuZm9ybS5sYXN0TmFtZSgpLFxuICAgICAgc2FsdXRhdGlvbjogdGhpcy5mb3JtLnNhbHV0YXRpb24oKSxcbiAgICAgIGNvbXBhbnk6IHRoaXMuZm9ybS5jb21wYW55KCksXG4gICAgICBzdHJlZXQ6IHRoaXMuZm9ybS5zdHJlZXQoKSxcbiAgICAgIHN0cmVldG5yOiB0aGlzLmZvcm0uc3RyZWV0bnIoKSxcbiAgICAgIHppcDogdGhpcy5mb3JtLnppcCgpLFxuICAgICAgbG9jYXRpb246IHRoaXMuZm9ybS5sb2NhdGlvbigpLFxuICAgICAgZW1haWw6IHRoaXMuZm9ybS5lbWFpbCgpLFxuICAgICAgcGhvbmU6IHRoaXMuZm9ybS5waG9uZSgpLFxuICAgICAgc2VsZWN0ZWRUZW50czogdGhpcy5mb3JtLnNlbGVjdGVkVGVudHMoKSxcbiAgICAgIHNlbGVjdGVkRXF1aXBtZW50czogdGhpcy5mb3JtLnNlbGVjdGVkRXF1aXBtZW50cygpLFxuICAgICAgdG90YWxUZW50c1ByaWNlOiB0aGlzLmZvcm0udG90YWxUZW50c1ByaWNlKCksXG4gICAgICB0b3RhbEVxdWlwbWVudHNQcmljZTogdGhpcy5mb3JtLnRvdGFsRXF1aXBtZW50c1ByaWNlKCksXG4gICAgICB0b3RhbFByaWNlOiB0aGlzLmZvcm0udG90YWxQcmljZSgpLFxuICAgICAgdG90YWxNaW5QZXJzb25zOiB0aGlzLmZvcm0udG90YWxNaW5QZXJzb25zKCksXG4gICAgICB0b3RhbE1heFBlcnNvbnM6IHRoaXMuZm9ybS50b3RhbE1heFBlcnNvbnMoKSxcbiAgICAgIHRvdGFsU3F1YXJlTWV0ZXJzOiB0aGlzLmZvcm0udG90YWxTcXVhcmVNZXRlcnMoKVxuICAgIH07XG4gICAgbGV0IGFqYXh1cmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6ODg4OC93cC1hZG1pbi9hZG1pbi1hamF4LnBocFwiO1xuICAgIGpRdWVyeS5wb3N0KGFqYXh1cmwsIGRhdGEpXG4gICAgICAuZG9uZShmdW5jdGlvbihzZWxmKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsgc2VsZi5tb2RlKDEpOyB9O1xuICAgICAgfSh0aGlzKSlcbiAgICAgIC5mYWlsKGZ1bmN0aW9uKHNlbGYpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgeyBzZWxmLm1vZGUoMik7IH07XG4gICAgICB9KHRoaXMpKVxuICAgICAgLmFsd2F5cyhmdW5jdGlvbigpIHsgalF1ZXJ5KHdpbmRvdykuc2Nyb2xsVG9wKDApOyB9KTtcbiAgfVxuICByZWFkYWJsZVByaWNlKHByaWNlKSB7XG4gICAgcmV0dXJuIHByaWNlICsgJyBDSEYnO1xuICB9XG4gIHJlYWRhYmxlUGVyc29ucyhtaW5QZXJzb25zLCBtYXhQZXJzb25zKSB7XG4gICAgcmV0dXJuIG1pblBlcnNvbnMgKyAnIC0gJyArIG1heFBlcnNvbnMgKyAnIFBlcnNvbmVuJztcbiAgfVxuICBjdXJyZW50V2l6YXJkU3RlcElkKCkge1xuICAgIHJldHVybiB0aGlzLnN0ZXBzKCkuaW5kZXhPZih0aGlzLmN1cnJlbnRTdGVwKCkpO1xuICB9XG59XG5cbmpRdWVyeShkb2N1bWVudCkucmVhZHkgKCBmdW5jdGlvbigpe1xuICBrby5hcHBseUJpbmRpbmdzKG5ldyBXaXphcmQoKSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dpemFyZC1mb3JtJykpO1xufSk7XG4iXX0=
