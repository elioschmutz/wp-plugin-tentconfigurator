'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Tent = function Tent(id, title, price, length, width, minPersons, maxPersons) {
  _classCallCheck(this, Tent);

  this.id = id;
  this.title = title;
  this.price = price;
  this.length = length;
  this.width = width;
  this.minPersons = minPersons;
  this.maxPersons = maxPersons;
  this.squareMeter = this.length * this.width;
};

var Equipment = function Equipment(id, title, price, description) {
  _classCallCheck(this, Equipment);

  this.id = id;
  this.title = title;
  this.price = price;
  this.description = description;
};

var WizardStep = function () {
  function WizardStep() {
    var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
    var wizardForm = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

    _classCallCheck(this, WizardStep);

    this.name = name;
    this.active = ko.observable(false);
    this.activeSubStep = ko.observable();
    this.wizardForm = wizardForm;
    this.isVisible = ko.computed(function () {
      return this.active() && !this.activeSubStep();
    }, this);
  }

  _createClass(WizardStep, [{
    key: 'openSubStep',
    value: function openSubStep(substep) {
      substep.active(true);
      this.activeSubStep(substep);
    }
  }, {
    key: 'closeSubStep',
    value: function closeSubStep() {
      this.activeSubStep().active(false);
      this.activeSubStep(null);
    }
  }, {
    key: 'removeDataRow',
    value: function removeDataRow() {
      throw new Error('Override this function');
    }
  }]);

  return WizardStep;
}();

var WizardSubStep = function (_WizardStep) {
  _inherits(WizardSubStep, _WizardStep);

  function WizardSubStep(parent) {
    var _ref;

    _classCallCheck(this, WizardSubStep);

    for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
      args[_key - 1] = arguments[_key];
    }

    var _this = _possibleConstructorReturn(this, (_ref = WizardSubStep.__proto__ || Object.getPrototypeOf(WizardSubStep)).call.apply(_ref, [this].concat(args)));

    _this.parent = parent;
    _this.isVisible = ko.computed(function () {
      return this.active() && this.parent.active();
    }, _this);
    return _this;
  }

  return WizardSubStep;
}(WizardStep);

var WizardStepTents = function (_WizardStep2) {
  _inherits(WizardStepTents, _WizardStep2);

  function WizardStepTents() {
    var _ref2;

    _classCallCheck(this, WizardStepTents);

    for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
      args[_key2] = arguments[_key2];
    }

    var _this2 = _possibleConstructorReturn(this, (_ref2 = WizardStepTents.__proto__ || Object.getPrototypeOf(WizardStepTents)).call.apply(_ref2, [this].concat(args)));

    _this2.selectTentsSubStep = new WizardStepSelectTents(_this2);
    _this2.openSubStep(_this2.selectTentsSubStep);
    return _this2;
  }

  _createClass(WizardStepTents, [{
    key: 'openSelectTent',
    value: function openSelectTent() {
      this.openSubStep(this.selectTentsSubStep);
    }
  }, {
    key: 'removeDataRow',
    value: function removeDataRow(tent) {
      this.wizardForm.selectedTents.remove(tent);
    }
  }]);

  return WizardStepTents;
}(WizardStep);

var WizardStepEquipment = function (_WizardStep3) {
  _inherits(WizardStepEquipment, _WizardStep3);

  function WizardStepEquipment() {
    var _ref3;

    _classCallCheck(this, WizardStepEquipment);

    for (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
      args[_key3] = arguments[_key3];
    }

    var _this3 = _possibleConstructorReturn(this, (_ref3 = WizardStepEquipment.__proto__ || Object.getPrototypeOf(WizardStepEquipment)).call.apply(_ref3, [this].concat(args)));

    _this3.selectEquipmentubStep = new WizardStepSelectEquipment(_this3);
    _this3.openSubStep(_this3.selectEquipmentubStep);
    return _this3;
  }

  _createClass(WizardStepEquipment, [{
    key: 'openSelectEquipment',
    value: function openSelectEquipment() {
      this.openSubStep(this.selectEquipmentubStep);
    }
  }, {
    key: 'removeDataRow',
    value: function removeDataRow(equipment) {
      this.wizardForm.selectedEquipment.remove(equipment);
    }
  }]);

  return WizardStepEquipment;
}(WizardStep);

var WizardStepEvent = function (_WizardStep4) {
  _inherits(WizardStepEvent, _WizardStep4);

  function WizardStepEvent() {
    _classCallCheck(this, WizardStepEvent);

    return _possibleConstructorReturn(this, (WizardStepEvent.__proto__ || Object.getPrototypeOf(WizardStepEvent)).apply(this, arguments));
  }

  return WizardStepEvent;
}(WizardStep);

var WizardStepContact = function (_WizardStep5) {
  _inherits(WizardStepContact, _WizardStep5);

  function WizardStepContact() {
    var _ref4;

    _classCallCheck(this, WizardStepContact);

    for (var _len4 = arguments.length, args = Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
      args[_key4] = arguments[_key4];
    }

    var _this5 = _possibleConstructorReturn(this, (_ref4 = WizardStepContact.__proto__ || Object.getPrototypeOf(WizardStepContact)).call.apply(_ref4, [this].concat(args)));

    _this5.availableGenders = ko.observableArray(['Herr', 'Frau']);
    return _this5;
  }

  return WizardStepContact;
}(WizardStep);

var WizardStepSelectTents = function (_WizardSubStep) {
  _inherits(WizardStepSelectTents, _WizardSubStep);

  function WizardStepSelectTents(parent) {
    var _ref5;

    _classCallCheck(this, WizardStepSelectTents);

    for (var _len5 = arguments.length, args = Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {
      args[_key5 - 1] = arguments[_key5];
    }

    return _possibleConstructorReturn(this, (_ref5 = WizardStepSelectTents.__proto__ || Object.getPrototypeOf(WizardStepSelectTents)).call.apply(_ref5, [this, parent].concat(args)));
  }

  _createClass(WizardStepSelectTents, [{
    key: 'selectTent',
    value: function selectTent(tent) {
      this.parent.wizardForm.selectedTents.push(Object.assign(new Tent(), tent));
      this.parent.closeSubStep();
    }
  }]);

  return WizardStepSelectTents;
}(WizardSubStep);

var WizardStepSelectEquipment = function (_WizardSubStep2) {
  _inherits(WizardStepSelectEquipment, _WizardSubStep2);

  function WizardStepSelectEquipment() {
    _classCallCheck(this, WizardStepSelectEquipment);

    return _possibleConstructorReturn(this, (WizardStepSelectEquipment.__proto__ || Object.getPrototypeOf(WizardStepSelectEquipment)).apply(this, arguments));
  }

  _createClass(WizardStepSelectEquipment, [{
    key: 'selectEquipment',
    value: function selectEquipment(equipment) {
      this.parent.wizardForm.selectedEquipment.push(Object.assign(new Equipment(), equipment));
      this.parent.closeSubStep();
    }
  }]);

  return WizardStepSelectEquipment;
}(WizardSubStep);

var WizardForm = function () {
  function WizardForm() {
    _classCallCheck(this, WizardForm);

    this.firstName = ko.observable();
    this.lastName = ko.observable();
    this.salutation = ko.observable();
    this.company = ko.observable();
    this.street = ko.observable();
    this.streetnr = ko.observable();
    this.zip = ko.observable();
    this.location = ko.observable();
    this.email = ko.observable();
    this.phone = ko.observable();
    this.comment = ko.observable();
    this.acceptTerms = ko.observable(false);

    this.eventname = ko.observable();
    this.eventdays = ko.observable(1);
    this.eventlocation = ko.observable();
    this.eventlocationdistance = ko.observable(0);
    this.eventstartdate = ko.observable();

    this.tents = ko.observableArray();
    this.equipment = ko.observableArray();
    this.selectedTents = ko.observableArray();
    this.selectedEquipment = ko.observableArray();
    this.transportPrice = ko.computed(function () {
      if (this.eventlocationdistance() <= 10000) {
        return 0;
      } else {
        // 50.- each 30km * 2 (for twice the distance)
        return Math.ceil(this.eventlocationdistance() / 1000 / 30) * 50 * 2;
      }
    }, this);
    this.totalTentsPrice = ko.computed(function () {
      return this._count_objs_attribute(this.selectedTents(), 'price');
    }, this);
    this.totalEquipmentPrice = ko.computed(function () {
      return this._count_objs_attribute(this.selectedEquipment(), 'price');
    }, this);
    this.totalPrice = ko.computed(function () {
      // Includes the eventdays
      return (this.totalTentsPrice() + this.totalEquipmentPrice()) * this.eventdays() + this.transportPrice();
    }, this);
    this.totalMinPersons = ko.computed(function () {
      return this._count_objs_attribute(this.selectedTents(), 'minPersons');
    }, this);
    this.totalMaxPersons = ko.computed(function () {
      return this._count_objs_attribute(this.selectedTents(), 'maxPersons');
    }, this);
    this.totalSquareMeters = ko.computed(function () {
      return this._count_objs_attribute(this.selectedTents(), 'squareMeter');
    }, this);
  }

  _createClass(WizardForm, [{
    key: '_count_objs_attribute',
    value: function _count_objs_attribute(objs, attr) {
      var total = 0;
      objs.forEach(function (obj) {
        total += obj[attr];
      });
      return total;
    }
  }]);

  return WizardForm;
}();

var Wizard = function () {
  function Wizard() {
    _classCallCheck(this, Wizard);

    this.debug = false;
    if (typeof ajaxurl === 'undefined') {
      // wordpress sets the ajaxurl in the global scope.
      // If the ajaxurl is not initialized, we are not in a wordpress
      // environment.
      this.debug = true;
    }
    this.form = new WizardForm();
    // 0 = Fillout, 1 = Success, 2 = Error, 3 = pending, 4 = FormValidation error
    this.mode = ko.observable(0);
    this.steps = ko.observableArray([new WizardStepTents('Zelt', this.form), new WizardStepEquipment('Zubehör', this.form), new WizardStepEvent('Anlass', this.form), new WizardStepContact('Kontakt', this.form)]);
    this.addressNotFound = ko.observable(false);
    this.currentStep = ko.observable(this.steps()[0]);
    this.isLastStep = ko.computed(function () {
      return this.currentWizardStepId() >= this.steps().length - 1;
    }, this);
    this.showPrevButton = ko.computed(function () {
      return this.currentWizardStepId() > 0;
    }, this);
    this.nextButtonText = ko.computed(function () {
      if (this.isLastStep()) {
        return "Offerte anfordern";
      }
      return "Weiter";
    }, this);
    this.showNextButton = true;
    ko.computed(function () {
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = this.steps()[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var step = _step.value;

          step.active(false);
          if (this.currentStep() == step) {
            step.active(true);
          }
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }
    }, this);

    this.loadData();
    jQuery(document).on('focusout', 'input[required], select[required]', function (self) {
      return function () {
        self.validateField(this);
      };
    }(this));
  }

  _createClass(Wizard, [{
    key: 'next',
    value: function next() {
      if (this.isLastStep()) {
        this.send();
      } else {
        this.currentStep(this.steps()[this.currentWizardStepId() + 1]);
      }
    }
  }, {
    key: 'previous',
    value: function previous() {
      this.currentStep(this.steps()[this.currentWizardStepId() - 1]);
    }
  }, {
    key: 'loadData',
    value: function loadData() {
      var self = this;
      var request = this._make_request({ action: 'kah_get_data' });
      request.then(function (response) {
        var tents = [];
        var equipment = [];
        if (self.debug) {
          tents = [new Tent(1, 'Zelttitel 1', 15, 4, 20, 100, 150), new Tent(2, 'Zelttitel 2', 30, 8, 20, 200, 300), new Tent(3, 'Zelttitel 3', 50, 12, 20, 150, 300)];
          equipment = [new Equipment(1, 'Lampe', 5, 'kleine Lampe für das DJ Pult'), new Equipment(2, 'Bodenplatte 30x30 cm', 2, 'Um den Boden zu schützen'), new Equipment(3, 'Tisch - 3 Meter ', 9, "für 6 Personen"), new Equipment(4, 'Tisch - 5 Meter ', 9, "für 9 Personen")];
        } else {
          response.tents.forEach(function (tent) {
            tents.push(new Tent(tent.id, tent.title, tent.price, tent.length, tent.width, tent.minPersons, tent.maxPersons));
          });
          response.equipment.forEach(function (equipmentItem) {
            equipment.push(new Equipment(equipmentItem.id, equipmentItem.title, equipmentItem.price, equipmentItem.description));
          });
        }
        self.form.tents(tents.sort(function (a, b) {
          return a.minPersons - b.minPersons;
        }));
        self.form.equipment(equipment);
      });
    }
  }, {
    key: 'send',
    value: function send() {
      jQuery(window).scrollTop(0);
      if (!this.validateForm()) {
        this.mode(4);
        return;
      }
      this.mode(3);
      var self = this;
      var data = {
        action: 'kah_send_offer',
        salutation: this.form.salutation(),
        firstName: this.form.firstName(),
        lastName: this.form.lastName(),
        company: this.form.company(),
        street: this.form.street(),
        streetnr: this.form.streetnr(),
        zip: this.form.zip(),
        location: this.form.location(),
        email: this.form.email(),
        phone: this.form.phone(),
        comment: this.form.comment(),
        acceptTerms: this.form.acceptTerms(),
        eventname: this.form.eventname(),
        eventdays: this.form.eventdays(),
        eventlocation: this.form.eventlocation(),
        eventlocationdistance: this.form.eventlocationdistance(),
        eventstartdate: this.form.eventstartdate(),
        transportPrice: this.form.transportPrice(),
        totalTentsPrice: this.form.totalTentsPrice(),
        totalEquipmentPrice: this.form.totalEquipmentPrice(),
        totalPrice: this.form.totalPrice(),
        totalMinPersons: this.form.totalMinPersons(),
        totalMaxPersons: this.form.totalMaxPersons(),
        totalSquareMeters: this.form.totalSquareMeters(),
        selectedTents: this.form.selectedTents()
      };
      console.log(data);
      var request = this._make_request(data);
      request.then(function () {
        self.mode(1);
      }, function () {
        self.mode(2);
      });
    }
  }, {
    key: 'readablePrice',
    value: function readablePrice(price) {
      return price + ' CHF';
    }
  }, {
    key: 'readablePersons',
    value: function readablePersons(minPersons, maxPersons) {
      return minPersons + ' - ' + maxPersons + ' Personen';
    }
  }, {
    key: 'currentWizardStepId',
    value: function currentWizardStepId() {
      return this.steps().indexOf(this.currentStep());
    }
  }, {
    key: '_make_request',
    value: function _make_request(data) {
      var self = this;
      return new Promise(function (resolve, reject) {

        if (self.debug) {
          window.setTimeout(function () {
            resolve();
          }, 2000);
        } else {
          jQuery.post(ajaxurl, data).done(function (response) {
            if (typeof response.success !== 'undefined' && !response.success) {
              reject();
            } else {
              resolve(response);
            }
          }).fail(function (error) {
            reject(error);
          });
        }
      });
    }
  }, {
    key: 'validateForm',
    value: function validateForm() {
      var valid = true;
      var setInvalidForm = true;
      jQuery('input[required], select[required]').each(function (self) {
        return function (counter, field) {
          if (!self.validateField(field)) {
            valid = false;
            if (setInvalidForm) {
              self.currentStep(ko.dataFor(jQuery(field).closest('.wizardStepView')[0]));
              setInvalidForm = false;
            }
          }
        };
      }(this));
      return valid;
    }
  }, {
    key: 'validateField',
    value: function validateField(field) {
      var msgBox = field.previousElementSibling;
      if (msgBox === null) {
        msgBox = field.parentElement.previousElementSibling;
      }
      if (field.checkValidity()) {
        jQuery(msgBox).hide();
        return true;
      } else {
        msgBox.innerHTML = field.validationMessage;
        jQuery(msgBox).show();
        return false;
      }
    }
  }, {
    key: 'calculateDistance',
    value: function calculateDistance(place) {
      var self = this;
      if (typeof place === 'undefined') {
        self.addressNotFound(true);
        return;
      };

      var origin = 'Hauptstrasse 95, 1715 Alterswil, Schweiz';
      var destination = new google.maps.LatLng(place.geometry.location.lat(), place.geometry.location.lng());
      var service = new google.maps.DistanceMatrixService();
      service.getDistanceMatrix({
        origins: [origin],
        destinations: [destination],
        travelMode: google.maps.TravelMode.DRIVING }, function (response, status) {
        if (status == google.maps.DistanceMatrixStatus.OK) {
          var distancematrix = response.rows[0].elements[0];
          if (distancematrix.status == google.maps.DistanceMatrixStatus.OK) {
            self.form.eventlocationdistance(distancematrix.distance.value);
            self.addressNotFound(false);
          }
        }
      });
    }
  }, {
    key: 'initGoogleSearch',
    value: function initGoogleSearch() {
      // We call this funciton from outside. So we have to set 
      // the wizard itself to be able to access its functions.
      var self = window.wizard;
      jQuery(window).on('load', function () {
        var input = document.getElementById('eventlocation');
        var searchBox = new google.maps.places.SearchBox(input);
        searchBox.addListener('places_changed', function () {
          self.calculateDistance(searchBox.getPlaces()[0]);
        });
        google.maps.event.addDomListener(input, 'keydown', function (e) {
          if (e.keyCode == 13) {
            e.preventDefault();
          }
        });
      });
    }
  }]);

  return Wizard;
}();

window.wizard = new Wizard();
var initGoogleSearch = window.wizard.initGoogleSearch;

jQuery(window).on('load', function () {
  ko.applyBindings(window.wizard, document.getElementById('wizard-form'));
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiVGVudCIsImlkIiwidGl0bGUiLCJwcmljZSIsImxlbmd0aCIsIndpZHRoIiwibWluUGVyc29ucyIsIm1heFBlcnNvbnMiLCJzcXVhcmVNZXRlciIsIkVxdWlwbWVudCIsImRlc2NyaXB0aW9uIiwiV2l6YXJkU3RlcCIsIm5hbWUiLCJ3aXphcmRGb3JtIiwiYWN0aXZlIiwia28iLCJvYnNlcnZhYmxlIiwiYWN0aXZlU3ViU3RlcCIsImlzVmlzaWJsZSIsImNvbXB1dGVkIiwic3Vic3RlcCIsIkVycm9yIiwiV2l6YXJkU3ViU3RlcCIsInBhcmVudCIsImFyZ3MiLCJXaXphcmRTdGVwVGVudHMiLCJzZWxlY3RUZW50c1N1YlN0ZXAiLCJXaXphcmRTdGVwU2VsZWN0VGVudHMiLCJvcGVuU3ViU3RlcCIsInRlbnQiLCJzZWxlY3RlZFRlbnRzIiwicmVtb3ZlIiwiV2l6YXJkU3RlcEVxdWlwbWVudCIsInNlbGVjdEVxdWlwbWVudHViU3RlcCIsIldpemFyZFN0ZXBTZWxlY3RFcXVpcG1lbnQiLCJlcXVpcG1lbnQiLCJzZWxlY3RlZEVxdWlwbWVudCIsIldpemFyZFN0ZXBFdmVudCIsIldpemFyZFN0ZXBDb250YWN0IiwiYXZhaWxhYmxlR2VuZGVycyIsIm9ic2VydmFibGVBcnJheSIsInB1c2giLCJPYmplY3QiLCJhc3NpZ24iLCJjbG9zZVN1YlN0ZXAiLCJXaXphcmRGb3JtIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJzYWx1dGF0aW9uIiwiY29tcGFueSIsInN0cmVldCIsInN0cmVldG5yIiwiemlwIiwibG9jYXRpb24iLCJlbWFpbCIsInBob25lIiwiY29tbWVudCIsImFjY2VwdFRlcm1zIiwiZXZlbnRuYW1lIiwiZXZlbnRkYXlzIiwiZXZlbnRsb2NhdGlvbiIsImV2ZW50bG9jYXRpb25kaXN0YW5jZSIsImV2ZW50c3RhcnRkYXRlIiwidGVudHMiLCJ0cmFuc3BvcnRQcmljZSIsIk1hdGgiLCJjZWlsIiwidG90YWxUZW50c1ByaWNlIiwiX2NvdW50X29ianNfYXR0cmlidXRlIiwidG90YWxFcXVpcG1lbnRQcmljZSIsInRvdGFsUHJpY2UiLCJ0b3RhbE1pblBlcnNvbnMiLCJ0b3RhbE1heFBlcnNvbnMiLCJ0b3RhbFNxdWFyZU1ldGVycyIsIm9ianMiLCJhdHRyIiwidG90YWwiLCJmb3JFYWNoIiwib2JqIiwiV2l6YXJkIiwiZGVidWciLCJhamF4dXJsIiwiZm9ybSIsIm1vZGUiLCJzdGVwcyIsImFkZHJlc3NOb3RGb3VuZCIsImN1cnJlbnRTdGVwIiwiaXNMYXN0U3RlcCIsImN1cnJlbnRXaXphcmRTdGVwSWQiLCJzaG93UHJldkJ1dHRvbiIsIm5leHRCdXR0b25UZXh0Iiwic2hvd05leHRCdXR0b24iLCJzdGVwIiwibG9hZERhdGEiLCJqUXVlcnkiLCJkb2N1bWVudCIsIm9uIiwic2VsZiIsInZhbGlkYXRlRmllbGQiLCJzZW5kIiwicmVxdWVzdCIsIl9tYWtlX3JlcXVlc3QiLCJhY3Rpb24iLCJ0aGVuIiwicmVzcG9uc2UiLCJlcXVpcG1lbnRJdGVtIiwic29ydCIsImEiLCJiIiwid2luZG93Iiwic2Nyb2xsVG9wIiwidmFsaWRhdGVGb3JtIiwiZGF0YSIsImNvbnNvbGUiLCJsb2ciLCJpbmRleE9mIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJzZXRUaW1lb3V0IiwicG9zdCIsImRvbmUiLCJzdWNjZXNzIiwiZmFpbCIsImVycm9yIiwidmFsaWQiLCJzZXRJbnZhbGlkRm9ybSIsImVhY2giLCJjb3VudGVyIiwiZmllbGQiLCJkYXRhRm9yIiwiY2xvc2VzdCIsIm1zZ0JveCIsInByZXZpb3VzRWxlbWVudFNpYmxpbmciLCJwYXJlbnRFbGVtZW50IiwiY2hlY2tWYWxpZGl0eSIsImhpZGUiLCJpbm5lckhUTUwiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsInNob3ciLCJwbGFjZSIsIm9yaWdpbiIsImRlc3RpbmF0aW9uIiwiZ29vZ2xlIiwibWFwcyIsIkxhdExuZyIsImdlb21ldHJ5IiwibGF0IiwibG5nIiwic2VydmljZSIsIkRpc3RhbmNlTWF0cml4U2VydmljZSIsImdldERpc3RhbmNlTWF0cml4Iiwib3JpZ2lucyIsImRlc3RpbmF0aW9ucyIsInRyYXZlbE1vZGUiLCJUcmF2ZWxNb2RlIiwiRFJJVklORyIsInN0YXR1cyIsIkRpc3RhbmNlTWF0cml4U3RhdHVzIiwiT0siLCJkaXN0YW5jZW1hdHJpeCIsInJvd3MiLCJlbGVtZW50cyIsImRpc3RhbmNlIiwidmFsdWUiLCJ3aXphcmQiLCJpbnB1dCIsImdldEVsZW1lbnRCeUlkIiwic2VhcmNoQm94IiwicGxhY2VzIiwiU2VhcmNoQm94IiwiYWRkTGlzdGVuZXIiLCJjYWxjdWxhdGVEaXN0YW5jZSIsImdldFBsYWNlcyIsImV2ZW50IiwiYWRkRG9tTGlzdGVuZXIiLCJlIiwia2V5Q29kZSIsInByZXZlbnREZWZhdWx0IiwiaW5pdEdvb2dsZVNlYXJjaCIsImFwcGx5QmluZGluZ3MiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7SUFBTUEsT0FDSixjQUFZQyxFQUFaLEVBQWdCQyxLQUFoQixFQUF1QkMsS0FBdkIsRUFBOEJDLE1BQTlCLEVBQXNDQyxLQUF0QyxFQUE2Q0MsVUFBN0MsRUFBeURDLFVBQXpELEVBQXFFO0FBQUE7O0FBQ25FLE9BQUtOLEVBQUwsR0FBVUEsRUFBVjtBQUNBLE9BQUtDLEtBQUwsR0FBYUEsS0FBYjtBQUNBLE9BQUtDLEtBQUwsR0FBYUEsS0FBYjtBQUNBLE9BQUtDLE1BQUwsR0FBY0EsTUFBZDtBQUNBLE9BQUtDLEtBQUwsR0FBYUEsS0FBYjtBQUNBLE9BQUtDLFVBQUwsR0FBa0JBLFVBQWxCO0FBQ0EsT0FBS0MsVUFBTCxHQUFrQkEsVUFBbEI7QUFDQSxPQUFLQyxXQUFMLEdBQW1CLEtBQUtKLE1BQUwsR0FBYyxLQUFLQyxLQUF0QztBQUNEOztJQUdHSSxZQUNKLG1CQUFZUixFQUFaLEVBQWdCQyxLQUFoQixFQUF1QkMsS0FBdkIsRUFBOEJPLFdBQTlCLEVBQTJDO0FBQUE7O0FBQ3pDLE9BQUtULEVBQUwsR0FBVUEsRUFBVjtBQUNBLE9B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QVVLLFNBQVYsR0FBc0IsQ0FBdEIsQ0FBdkI7QUFDRCxTQUZEO0FBR0E5QixlQUFPQyxJQUFQLENBQVk4QixLQUFaLENBQWtCQyxjQUFsQixDQUFpQ1QsS0FBakMsRUFBd0MsU0FBeEMsRUFBbUQsVUFBU1UsQ0FBVCxFQUFZO0FBQzdELGNBQUlBLEVBQUVDLE9BQUYsSUFBYSxFQUFqQixFQUFxQjtBQUNqQkQsY0FBRUUsY0FBRjtBQUNIO0FBQ0YsU0FKRDtBQUtELE9BWEQ7QUFZRDs7Ozs7O0FBR0hyRSxPQUFPd0QsTUFBUCxHQUFnQixJQUFJdEYsTUFBSixFQUFoQjtBQUNBLElBQUlvRyxtQkFBbUJ0RSxPQUFPd0QsTUFBUCxDQUFjYyxnQkFBckM7O0FBRUFyRixPQUFPZSxNQUFQLEVBQWViLEVBQWYsQ0FBa0IsTUFBbEIsRUFBMEIsWUFBVztBQUNuQ2pGLEtBQUdxSyxhQUFILENBQWlCdkUsT0FBT3dELE1BQXhCLEVBQWdDdEUsU0FBU3dFLGNBQVQsQ0FBd0IsYUFBeEIsQ0FBaEM7QUFDRCxDQUZEIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBUZW50IHtcbiAgY29uc3RydWN0b3IoaWQsIHRpdGxlLCBwcmljZSwgbGVuZ3RoLCB3aWR0aCwgbWluUGVyc29ucywgbWF4UGVyc29ucykge1xuICAgIHRoaXMuaWQgPSBpZDtcbiAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgdGhpcy5wcmljZSA9IHByaWNlO1xuICAgIHRoaXMubGVuZ3RoID0gbGVuZ3RoO1xuICAgIHRoaXMud2lkdGggPSB3aWR0aDtcbiAgICB0aGlzLm1pblBlcnNvbnMgPSBtaW5QZXJzb25zO1xuICAgIHRoaXMubWF4UGVyc29ucyA9IG1heFBlcnNvbnM7XG4gICAgdGhpcy5zcXVhcmVNZXRlciA9IHRoaXMubGVuZ3RoICogdGhpcy53aWR0aDtcbiAgfVxufVxuXG5jbGFzcyBFcXVpcG1lbnQge1xuICBjb25zdHJ1Y3RvcihpZCwgdGl0bGUsIHByaWNlLCBkZXNjcmlwdGlvbikge1xuICAgIHRoaXMuaWQgPSBpZDtcbiAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgdGhpcy5wcmljZSA9IHByaWNlOyBcbiAgICB0aGlzLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gIH1cbn1cblxuY2xhc3MgV2l6YXJkU3RlcCB7XG4gIGNvbnN0cnVjdG9yKG5hbWU9JycsIHdpemFyZEZvcm09bnVsbCkge1xuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5hY3RpdmUgPSBrby5vYnNlcnZhYmxlKGZhbHNlKTtcbiAgICB0aGlzLmFjdGl2ZVN1YlN0ZXAgPSBrby5vYnNlcnZhYmxlKCk7XG4gICAgdGhpcy53aXphcmRGb3JtID0gd2l6YXJkRm9ybTtcbiAgICB0aGlzLmlzVmlzaWJsZSA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlKCkgJiYgIXRoaXMuYWN0aXZlU3ViU3RlcCgpO1xuICAgIH0sIHRoaXMpO1xuICB9XG4gIG9wZW5TdWJTdGVwKHN1YnN0ZXApIHtcbiAgICBzdWJzdGVwLmFjdGl2ZSh0cnVlKTtcbiAgICB0aGlzLmFjdGl2ZVN1YlN0ZXAoc3Vic3RlcCk7XG4gIH1cbiAgY2xvc2VTdWJTdGVwKCkge1xuICAgIHRoaXMuYWN0aXZlU3ViU3RlcCgpLmFjdGl2ZShmYWxzZSk7XG4gICAgdGhpcy5hY3RpdmVTdWJTdGVwKG51bGwpO1xuICB9XG4gIHJlbW92ZURhdGFSb3coKSB7IHRocm93IG5ldyBFcnJvcignT3ZlcnJpZGUgdGhpcyBmdW5jdGlvbicpOyB9XG59XG5cbmNsYXNzIFdpemFyZFN1YlN0ZXAgZXh0ZW5kcyBXaXphcmRTdGVwIHtcbiAgY29uc3RydWN0b3IocGFyZW50LCAuLi5hcmdzKSB7XG4gICAgc3VwZXIoLi4uYXJncyk7XG4gICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG4gICAgdGhpcy5pc1Zpc2libGUgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLmFjdGl2ZSgpICYmIHRoaXMucGFyZW50LmFjdGl2ZSgpO1xuICAgIH0sIHRoaXMpO1xuICB9XG59XG5jbGFzcyBXaXphcmRTdGVwVGVudHMgZXh0ZW5kcyBXaXphcmRTdGVwIHtcbiAgY29uc3RydWN0b3IoLi4uYXJncykge1xuICAgIHN1cGVyKC4uLmFyZ3MpO1xuICAgIHRoaXMuc2VsZWN0VGVudHNTdWJTdGVwID0gbmV3IFdpemFyZFN0ZXBTZWxlY3RUZW50cyh0aGlzKTtcbiAgICB0aGlzLm9wZW5TdWJTdGVwKHRoaXMuc2VsZWN0VGVudHNTdWJTdGVwKTtcbiAgfVxuICBvcGVuU2VsZWN0VGVudCgpIHtcbiAgICB0aGlzLm9wZW5TdWJTdGVwKHRoaXMuc2VsZWN0VGVudHNTdWJTdGVwKTtcbiAgfVxuICByZW1vdmVEYXRhUm93KHRlbnQpIHtcbiAgICB0aGlzLndpemFyZEZvcm0uc2VsZWN0ZWRUZW50cy5yZW1vdmUodGVudCk7XG4gIH1cbn1cblxuY2xhc3MgV2l6YXJkU3RlcEVxdWlwbWVudCBleHRlbmRzIFdpemFyZFN0ZXAge1xuICBjb25zdHJ1Y3RvciguLi5hcmdzKSB7XG4gICAgc3VwZXIoLi4uYXJncyk7XG4gICAgdGhpcy5zZWxlY3RFcXVpcG1lbnR1YlN0ZXAgPSBuZXcgV2l6YXJkU3RlcFNlbGVjdEVxdWlwbWVudCh0aGlzKTtcbiAgICB0aGlzLm9wZW5TdWJTdGVwKHRoaXMuc2VsZWN0RXF1aXBtZW50dWJTdGVwKTtcbiAgfVxuICBvcGVuU2VsZWN0RXF1aXBtZW50KCkge1xuICAgIHRoaXMub3BlblN1YlN0ZXAodGhpcy5zZWxlY3RFcXVpcG1lbnR1YlN0ZXApO1xuICB9XG4gIHJlbW92ZURhdGFSb3coZXF1aXBtZW50KSB7XG4gICAgdGhpcy53aXphcmRGb3JtLnNlbGVjdGVkRXF1aXBtZW50LnJlbW92ZShlcXVpcG1lbnQpO1xuICB9IFxufVxuXG5jbGFzcyBXaXphcmRTdGVwRXZlbnQgZXh0ZW5kcyBXaXphcmRTdGVwIHtcbn1cblxuXG5jbGFzcyBXaXphcmRTdGVwQ29udGFjdCBleHRlbmRzIFdpemFyZFN0ZXAge1xuICBjb25zdHJ1Y3RvciguLi5hcmdzKSB7XG4gICAgc3VwZXIoLi4uYXJncyk7XG4gICAgdGhpcy5hdmFpbGFibGVHZW5kZXJzID0ga28ub2JzZXJ2YWJsZUFycmF5KFsnSGVycicsICdGcmF1J10pO1xuICB9XG59XG5cbmNsYXNzIFdpemFyZFN0ZXBTZWxlY3RUZW50cyBleHRlbmRzIFdpemFyZFN1YlN0ZXAge1xuICBjb25zdHJ1Y3RvcihwYXJlbnQsIC4uLmFyZ3MpIHtcbiAgICBzdXBlcihwYXJlbnQsIC4uLmFyZ3MpO1xuICB9XG4gIHNlbGVjdFRlbnQodGVudCkge1xuICAgIHRoaXMucGFyZW50LndpemFyZEZvcm0uc2VsZWN0ZWRUZW50cy5wdXNoKE9iamVjdC5hc3NpZ24obmV3IFRlbnQoKSwgdGVudCkpO1xuICAgIHRoaXMucGFyZW50LmNsb3NlU3ViU3RlcCgpO1xuICB9XG59XG5cbmNsYXNzIFdpemFyZFN0ZXBTZWxlY3RFcXVpcG1lbnQgZXh0ZW5kcyBXaXphcmRTdWJTdGVwIHtcbiAgc2VsZWN0RXF1aXBtZW50KGVxdWlwbWVudCkge1xuICAgIHRoaXMucGFyZW50LndpemFyZEZvcm0uc2VsZWN0ZWRFcXVpcG1lbnQucHVzaChPYmplY3QuYXNzaWduKG5ldyBFcXVpcG1lbnQoKSwgZXF1aXBtZW50KSk7XG4gICAgdGhpcy5wYXJlbnQuY2xvc2VTdWJTdGVwKCk7XG4gIH1cbn1cbmNsYXNzIFdpemFyZEZvcm0ge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmZpcnN0TmFtZSA9IGtvLm9ic2VydmFibGUoKTtcbiAgICB0aGlzLmxhc3ROYW1lID0ga28ub2JzZXJ2YWJsZSgpO1xuICAgIHRoaXMuc2FsdXRhdGlvbiA9IGtvLm9ic2VydmFibGUoKTtcbiAgICB0aGlzLmNvbXBhbnkgPSBrby5vYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5zdHJlZXQgPSBrby5vYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5zdHJlZXRuciA9IGtvLm9ic2VydmFibGUoKTtcbiAgICB0aGlzLnppcCA9IGtvLm9ic2VydmFibGUoKTtcbiAgICB0aGlzLmxvY2F0aW9uID0ga28ub2JzZXJ2YWJsZSgpO1xuICAgIHRoaXMuZW1haWwgPSBrby5vYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5waG9uZSA9IGtvLm9ic2VydmFibGUoKTtcbiAgICB0aGlzLmNvbW1lbnQgPSBrby5vYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5hY2NlcHRUZXJtcyA9IGtvLm9ic2VydmFibGUoZmFsc2UpO1xuXG4gICAgdGhpcy5ldmVudG5hbWUgPSBrby5vYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5ldmVudGRheXMgPSBrby5vYnNlcnZhYmxlKDEpO1xuICAgIHRoaXMuZXZlbnRsb2NhdGlvbiA9IGtvLm9ic2VydmFibGUoKTtcbiAgICB0aGlzLmV2ZW50bG9jYXRpb25kaXN0YW5jZSA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgdGhpcy5ldmVudHN0YXJ0ZGF0ZSA9IGtvLm9ic2VydmFibGUoKTtcblxuICAgIHRoaXMudGVudHMgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTtcbiAgICB0aGlzLmVxdWlwbWVudCA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xuICAgIHRoaXMuc2VsZWN0ZWRUZW50cyA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xuICAgIHRoaXMuc2VsZWN0ZWRFcXVpcG1lbnQgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTtcbiAgICB0aGlzLnRyYW5zcG9ydFByaWNlID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoIHRoaXMuZXZlbnRsb2NhdGlvbmRpc3RhbmNlKCkgPD0gMTAwMDAgKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gNTAuLSBlYWNoIDMwa20gKiAyIChmb3IgdHdpY2UgdGhlIGRpc3RhbmNlKVxuICAgICAgICByZXR1cm4gTWF0aC5jZWlsKHRoaXMuZXZlbnRsb2NhdGlvbmRpc3RhbmNlKCkgLyAxMDAwIC8gMzApICogNTAgKiAyO1xuICAgICAgfVxuICAgIH0sIHRoaXMpO1xuICAgIHRoaXMudG90YWxUZW50c1ByaWNlID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5fY291bnRfb2Jqc19hdHRyaWJ1dGUodGhpcy5zZWxlY3RlZFRlbnRzKCksICdwcmljZScpO1xuICAgIH0sIHRoaXMpO1xuICAgIHRoaXMudG90YWxFcXVpcG1lbnRQcmljZSA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NvdW50X29ianNfYXR0cmlidXRlKHRoaXMuc2VsZWN0ZWRFcXVpcG1lbnQoKSwgJ3ByaWNlJyk7XG4gICAgfSwgdGhpcyk7XG4gICAgdGhpcy50b3RhbFByaWNlID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICAvLyBJbmNsdWRlcyB0aGUgZXZlbnRkYXlzXG4gICAgICByZXR1cm4gKHRoaXMudG90YWxUZW50c1ByaWNlKCkgKyB0aGlzLnRvdGFsRXF1aXBtZW50UHJpY2UoKSkgKiB0aGlzLmV2ZW50ZGF5cygpICsgdGhpcy50cmFuc3BvcnRQcmljZSgpO1xuICAgIH0sIHRoaXMpO1xuICAgIHRoaXMudG90YWxNaW5QZXJzb25zID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5fY291bnRfb2Jqc19hdHRyaWJ1dGUodGhpcy5zZWxlY3RlZFRlbnRzKCksICdtaW5QZXJzb25zJyk7XG4gICAgfSwgdGhpcyk7XG4gICAgdGhpcy50b3RhbE1heFBlcnNvbnMgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLl9jb3VudF9vYmpzX2F0dHJpYnV0ZSh0aGlzLnNlbGVjdGVkVGVudHMoKSwgJ21heFBlcnNvbnMnKTtcbiAgICB9LCB0aGlzKTtcbiAgICB0aGlzLnRvdGFsU3F1YXJlTWV0ZXJzID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5fY291bnRfb2Jqc19hdHRyaWJ1dGUodGhpcy5zZWxlY3RlZFRlbnRzKCksICdzcXVhcmVNZXRlcicpO1xuICAgIH0sIHRoaXMpO1xuICB9XG4gIF9jb3VudF9vYmpzX2F0dHJpYnV0ZShvYmpzLCBhdHRyKSB7XG4gICAgbGV0IHRvdGFsID0gMDtcbiAgICBvYmpzLmZvckVhY2goZnVuY3Rpb24ob2JqKSB7IHRvdGFsICs9IG9ialthdHRyXTsgfSk7XG4gICAgcmV0dXJuIHRvdGFsO1xuICB9XG59XG5cbmNsYXNzIFdpemFyZCB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuZGVidWcgPSBmYWxzZTtcbiAgICBpZiAodHlwZW9mIGFqYXh1cmwgPT09ICd1bmRlZmluZWQnICkge1xuICAgICAgLy8gd29yZHByZXNzIHNldHMgdGhlIGFqYXh1cmwgaW4gdGhlIGdsb2JhbCBzY29wZS5cbiAgICAgIC8vIElmIHRoZSBhamF4dXJsIGlzIG5vdCBpbml0aWFsaXplZCwgd2UgYXJlIG5vdCBpbiBhIHdvcmRwcmVzc1xuICAgICAgLy8gZW52aXJvbm1lbnQuXG4gICAgICB0aGlzLmRlYnVnID0gdHJ1ZTtcbiAgICB9XG4gICAgdGhpcy5mb3JtID0gbmV3IFdpemFyZEZvcm0oKTtcbiAgICAvLyAwID0gRmlsbG91dCwgMSA9IFN1Y2Nlc3MsIDIgPSBFcnJvciwgMyA9IHBlbmRpbmcsIDQgPSBGb3JtVmFsaWRhdGlvbiBlcnJvclxuICAgIHRoaXMubW9kZSA9IGtvLm9ic2VydmFibGUoMCk7XG4gICAgdGhpcy5zdGVwcyA9IGtvLm9ic2VydmFibGVBcnJheShbXG4gICAgICBuZXcgV2l6YXJkU3RlcFRlbnRzKCdaZWx0JywgdGhpcy5mb3JtKSxcbiAgICAgIG5ldyBXaXphcmRTdGVwRXF1aXBtZW50KCdadWJlaMO2cicsIHRoaXMuZm9ybSksXG4gICAgICBuZXcgV2l6YXJkU3RlcEV2ZW50KCdBbmxhc3MnLCB0aGlzLmZvcm0pLFxuICAgICAgbmV3IFdpemFyZFN0ZXBDb250YWN0KCdLb250YWt0JywgdGhpcy5mb3JtKVxuICAgIF0pO1xuICAgIHRoaXMuYWRkcmVzc05vdEZvdW5kID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7XG4gICAgdGhpcy5jdXJyZW50U3RlcCA9IGtvLm9ic2VydmFibGUodGhpcy5zdGVwcygpWzBdKTtcbiAgICB0aGlzLmlzTGFzdFN0ZXAgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRXaXphcmRTdGVwSWQoKSA+PSB0aGlzLnN0ZXBzKCkubGVuZ3RoIC0gMTtcbiAgICB9LCB0aGlzKTtcbiAgICB0aGlzLnNob3dQcmV2QnV0dG9uID0ga28uY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5jdXJyZW50V2l6YXJkU3RlcElkKCkgPiAwO1xuICAgIH0sIHRoaXMpO1xuICAgIHRoaXMubmV4dEJ1dHRvblRleHQgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgIGlmICggdGhpcy5pc0xhc3RTdGVwKCkgKSB7XG4gICAgICAgIHJldHVybiBcIk9mZmVydGUgYW5mb3JkZXJuXCI7XG4gICAgICB9XG4gICAgICByZXR1cm4gXCJXZWl0ZXJcIjtcbiAgICB9LCB0aGlzKTtcbiAgICB0aGlzLnNob3dOZXh0QnV0dG9uID0gdHJ1ZTtcbiAgICBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgIGZvciAobGV0IHN0ZXAgb2YgdGhpcy5zdGVwcygpKSB7XG4gICAgICAgIHN0ZXAuYWN0aXZlKGZhbHNlKTtcbiAgICAgICAgaWYgKCB0aGlzLmN1cnJlbnRTdGVwKCkgPT0gc3RlcCApIHtcbiAgICAgICAgICBzdGVwLmFjdGl2ZSh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sIHRoaXMpO1xuXG4gICAgdGhpcy5sb2FkRGF0YSgpO1xuICAgIGpRdWVyeShkb2N1bWVudCkub24oJ2ZvY3Vzb3V0JywgJ2lucHV0W3JlcXVpcmVkXSwgc2VsZWN0W3JlcXVpcmVkXScsIGZ1bmN0aW9uKHNlbGYpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgc2VsZi52YWxpZGF0ZUZpZWxkKHRoaXMpO1xuICAgICAgfTtcbiAgICB9KHRoaXMpKTtcbiAgfVxuICBuZXh0KCkge1xuICAgIGlmICggdGhpcy5pc0xhc3RTdGVwKCkgKSB7XG4gICAgICB0aGlzLnNlbmQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jdXJyZW50U3RlcCh0aGlzLnN0ZXBzKClbdGhpcy5jdXJyZW50V2l6YXJkU3RlcElkKCkgKyAxXSk7XG4gICAgfVxuICB9XG4gIHByZXZpb3VzKCkge1xuICAgIHRoaXMuY3VycmVudFN0ZXAodGhpcy5zdGVwcygpW3RoaXMuY3VycmVudFdpemFyZFN0ZXBJZCgpIC0xXSk7XG4gIH1cbiAgbG9hZERhdGEoKSB7XG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgIGxldCByZXF1ZXN0ID0gdGhpcy5fbWFrZV9yZXF1ZXN0KHthY3Rpb246ICdrYWhfZ2V0X2RhdGEnfSk7XG4gICAgcmVxdWVzdC50aGVuKFxuICAgICAgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgbGV0IHRlbnRzID0gW107XG4gICAgICAgIGxldCBlcXVpcG1lbnQgPSBbXTtcbiAgICAgICAgaWYgKHNlbGYuZGVidWcpIHtcbiAgICAgICAgICB0ZW50cyA9IFtcbiAgICAgICAgICAgIG5ldyBUZW50KDEsICdaZWx0dGl0ZWwgMScsIDE1LCA0LCAyMCwgMTAwLCAxNTApLFxuICAgICAgICAgICAgbmV3IFRlbnQoMiwgJ1plbHR0aXRlbCAyJywgMzAsIDgsIDIwLCAyMDAsIDMwMCksXG4gICAgICAgICAgICBuZXcgVGVudCgzLCAnWmVsdHRpdGVsIDMnLCA1MCwgMTIsIDIwLCAxNTAsIDMwMCksXG4gICAgICAgICAgXTtcbiAgICAgICAgICBlcXVpcG1lbnQgPSBbXG4gICAgICAgICAgICBuZXcgRXF1aXBtZW50KDEsICdMYW1wZScsIDUsICdrbGVpbmUgTGFtcGUgZsO8ciBkYXMgREogUHVsdCcpLFxuICAgICAgICAgICAgbmV3IEVxdWlwbWVudCgyLCAnQm9kZW5wbGF0dGUgMzB4MzAgY20nLCAyLCAnVW0gZGVuIEJvZGVuIHp1IHNjaMO8dHplbicpLFxuICAgICAgICAgICAgbmV3IEVxdWlwbWVudCgzLCAnVGlzY2ggLSAzIE1ldGVyICcsIDksIFwiZsO8ciA2IFBlcnNvbmVuXCIpLFxuICAgICAgICAgICAgbmV3IEVxdWlwbWVudCg0LCAnVGlzY2ggLSA1IE1ldGVyICcsIDksIFwiZsO8ciA5IFBlcnNvbmVuXCIpXG4gICAgICAgICAgXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNwb25zZS50ZW50cy5mb3JFYWNoKGZ1bmN0aW9uKHRlbnQpIHtcbiAgICAgICAgICAgIHRlbnRzLnB1c2gobmV3IFRlbnQoXG4gICAgICAgICAgICAgIHRlbnQuaWQsXG4gICAgICAgICAgICAgIHRlbnQudGl0bGUsXG4gICAgICAgICAgICAgIHRlbnQucHJpY2UsXG4gICAgICAgICAgICAgIHRlbnQubGVuZ3RoLFxuICAgICAgICAgICAgICB0ZW50LndpZHRoLFxuICAgICAgICAgICAgICB0ZW50Lm1pblBlcnNvbnMsXG4gICAgICAgICAgICAgIHRlbnQubWF4UGVyc29ucykpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJlc3BvbnNlLmVxdWlwbWVudC5mb3JFYWNoKGZ1bmN0aW9uKGVxdWlwbWVudEl0ZW0pIHtcbiAgICAgICAgICAgIGVxdWlwbWVudC5wdXNoKG5ldyBFcXVpcG1lbnQoXG4gICAgICAgICAgICAgIGVxdWlwbWVudEl0ZW0uaWQsXG4gICAgICAgICAgICAgIGVxdWlwbWVudEl0ZW0udGl0bGUsXG4gICAgICAgICAgICAgIGVxdWlwbWVudEl0ZW0ucHJpY2UsXG4gICAgICAgICAgICAgIGVxdWlwbWVudEl0ZW0uZGVzY3JpcHRpb24pKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBzZWxmLmZvcm0udGVudHModGVudHMuc29ydCgoYSwgYikgPT4gYS5taW5QZXJzb25zIC0gYi5taW5QZXJzb25zKSk7XG4gICAgICAgIHNlbGYuZm9ybS5lcXVpcG1lbnQoZXF1aXBtZW50KTtcbiAgICAgIH0pO1xuICB9XG4gIHNlbmQoKSB7XG4gICAgalF1ZXJ5KHdpbmRvdykuc2Nyb2xsVG9wKDApO1xuICAgIGlmICggIXRoaXMudmFsaWRhdGVGb3JtKCkgKSB7XG4gICAgICB0aGlzLm1vZGUoNCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMubW9kZSgzKTtcbiAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgbGV0IGRhdGEgPSB7XG4gICAgICBhY3Rpb246ICdrYWhfc2VuZF9vZmZlcicsXG4gICAgICBzYWx1dGF0aW9uOiB0aGlzLmZvcm0uc2FsdXRhdGlvbigpLFxuICAgICAgZmlyc3ROYW1lOiB0aGlzLmZvcm0uZmlyc3ROYW1lKCksXG4gICAgICBsYXN0TmFtZTogdGhpcy5mb3JtLmxhc3ROYW1lKCksXG4gICAgICBjb21wYW55OiB0aGlzLmZvcm0uY29tcGFueSgpLFxuICAgICAgc3RyZWV0OiB0aGlzLmZvcm0uc3RyZWV0KCksXG4gICAgICBzdHJlZXRucjogdGhpcy5mb3JtLnN0cmVldG5yKCksXG4gICAgICB6aXA6IHRoaXMuZm9ybS56aXAoKSxcbiAgICAgIGxvY2F0aW9uOiB0aGlzLmZvcm0ubG9jYXRpb24oKSxcbiAgICAgIGVtYWlsOiB0aGlzLmZvcm0uZW1haWwoKSxcbiAgICAgIHBob25lOiB0aGlzLmZvcm0ucGhvbmUoKSxcbiAgICAgIGNvbW1lbnQ6IHRoaXMuZm9ybS5jb21tZW50KCksXG4gICAgICBhY2NlcHRUZXJtczogdGhpcy5mb3JtLmFjY2VwdFRlcm1zKCksXG4gICAgICBldmVudG5hbWU6IHRoaXMuZm9ybS5ldmVudG5hbWUoKSxcbiAgICAgIGV2ZW50ZGF5czogdGhpcy5mb3JtLmV2ZW50ZGF5cygpLFxuICAgICAgZXZlbnRsb2NhdGlvbjogdGhpcy5mb3JtLmV2ZW50bG9jYXRpb24oKSxcbiAgICAgIGV2ZW50bG9jYXRpb25kaXN0YW5jZTogdGhpcy5mb3JtLmV2ZW50bG9jYXRpb25kaXN0YW5jZSgpLFxuICAgICAgZXZlbnRzdGFydGRhdGU6IHRoaXMuZm9ybS5ldmVudHN0YXJ0ZGF0ZSgpLFxuICAgICAgdHJhbnNwb3J0UHJpY2U6IHRoaXMuZm9ybS50cmFuc3BvcnRQcmljZSgpLFxuICAgICAgdG90YWxUZW50c1ByaWNlOiB0aGlzLmZvcm0udG90YWxUZW50c1ByaWNlKCksXG4gICAgICB0b3RhbEVxdWlwbWVudFByaWNlOiB0aGlzLmZvcm0udG90YWxFcXVpcG1lbnRQcmljZSgpLFxuICAgICAgdG90YWxQcmljZTogdGhpcy5mb3JtLnRvdGFsUHJpY2UoKSxcbiAgICAgIHRvdGFsTWluUGVyc29uczogdGhpcy5mb3JtLnRvdGFsTWluUGVyc29ucygpLFxuICAgICAgdG90YWxNYXhQZXJzb25zOiB0aGlzLmZvcm0udG90YWxNYXhQZXJzb25zKCksXG4gICAgICB0b3RhbFNxdWFyZU1ldGVyczogdGhpcy5mb3JtLnRvdGFsU3F1YXJlTWV0ZXJzKCksXG4gICAgICBzZWxlY3RlZFRlbnRzOiB0aGlzLmZvcm0uc2VsZWN0ZWRUZW50cygpXG4gICAgfTtcbiAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICBsZXQgcmVxdWVzdCA9IHRoaXMuX21ha2VfcmVxdWVzdChkYXRhKTtcbiAgICByZXF1ZXN0LnRoZW4oXG4gICAgICBmdW5jdGlvbigpIHsgc2VsZi5tb2RlKDEpOyB9LFxuICAgICAgZnVuY3Rpb24oKSB7IHNlbGYubW9kZSgyKTsgfSk7XG4gIH1cbiAgcmVhZGFibGVQcmljZShwcmljZSkge1xuICAgIHJldHVybiBwcmljZSArICcgQ0hGJztcbiAgfVxuICByZWFkYWJsZVBlcnNvbnMobWluUGVyc29ucywgbWF4UGVyc29ucykge1xuICAgIHJldHVybiBtaW5QZXJzb25zICsgJyAtICcgKyBtYXhQZXJzb25zICsgJyBQZXJzb25lbic7XG4gIH1cbiAgY3VycmVudFdpemFyZFN0ZXBJZCgpIHtcbiAgICByZXR1cm4gdGhpcy5zdGVwcygpLmluZGV4T2YodGhpcy5jdXJyZW50U3RlcCgpKTtcbiAgfVxuICBfbWFrZV9yZXF1ZXN0KGRhdGEpIHtcbiAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgICBpZiAoIHNlbGYuZGVidWcgKSB7XG4gICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgfSwgMjAwMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBqUXVlcnkucG9zdChhamF4dXJsLCBkYXRhKVxuICAgICAgICAgIC5kb25lKGZ1bmN0aW9uKHJlc3BvbnNlKSB7IFxuICAgICAgICAgICAgaWYgKCB0eXBlb2YocmVzcG9uc2Uuc3VjY2VzcykgIT09ICd1bmRlZmluZWQnICYmICFyZXNwb25zZS5zdWNjZXNzICkge1xuICAgICAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZhaWwoZnVuY3Rpb24oZXJyb3IpIHsgcmVqZWN0KGVycm9yKTsgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgdmFsaWRhdGVGb3JtKCkge1xuICAgIGxldCB2YWxpZCA9IHRydWU7XG4gICAgbGV0IHNldEludmFsaWRGb3JtID0gdHJ1ZTtcbiAgICBqUXVlcnkoJ2lucHV0W3JlcXVpcmVkXSwgc2VsZWN0W3JlcXVpcmVkXScpLmVhY2goZnVuY3Rpb24oc2VsZikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKGNvdW50ZXIsIGZpZWxkKSB7XG4gICAgICAgIGlmICggIXNlbGYudmFsaWRhdGVGaWVsZChmaWVsZCkgKSB7IFxuICAgICAgICAgIHZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgaWYgKCBzZXRJbnZhbGlkRm9ybSApIHtcbiAgICAgICAgICAgIHNlbGYuY3VycmVudFN0ZXAoXG4gICAgICAgICAgICAgIGtvLmRhdGFGb3IoalF1ZXJ5KGZpZWxkKS5jbG9zZXN0KCcud2l6YXJkU3RlcFZpZXcnKVswXSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBzZXRJbnZhbGlkRm9ybSA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9KHRoaXMpKTtcbiAgICByZXR1cm4gdmFsaWQ7XG4gIH1cbiAgdmFsaWRhdGVGaWVsZChmaWVsZCkge1xuICAgIGxldCBtc2dCb3ggPSBmaWVsZC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xuICAgIGlmIChtc2dCb3ggPT09IG51bGwpIHtcbiAgICAgIG1zZ0JveCA9IGZpZWxkLnBhcmVudEVsZW1lbnQucHJldmlvdXNFbGVtZW50U2libGluZztcbiAgICB9XG4gICAgaWYgKCBmaWVsZC5jaGVja1ZhbGlkaXR5KCkgKSB7XG4gICAgICBqUXVlcnkobXNnQm94KS5oaWRlKCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgbXNnQm94LmlubmVySFRNTCA9IGZpZWxkLnZhbGlkYXRpb25NZXNzYWdlO1xuICAgICAgalF1ZXJ5KG1zZ0JveCkuc2hvdygpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICBjYWxjdWxhdGVEaXN0YW5jZShwbGFjZSkge1xuICAgIGxldCBzZWxmID0gdGhpcztcbiAgICBpZiAodHlwZW9mKHBsYWNlKSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHNlbGYuYWRkcmVzc05vdEZvdW5kKHRydWUpO1xuICAgICAgcmV0dXJuO1xuICAgIH07XG5cbiAgICBsZXQgb3JpZ2luID0gJ0hhdXB0c3RyYXNzZSA5NSwgMTcxNSBBbHRlcnN3aWwsIFNjaHdlaXonO1xuICAgIGxldCBkZXN0aW5hdGlvbiA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcocGxhY2UuZ2VvbWV0cnkubG9jYXRpb24ubGF0KCksIHBsYWNlLmdlb21ldHJ5LmxvY2F0aW9uLmxuZygpKTtcbiAgICBsZXQgc2VydmljZSA9IG5ldyBnb29nbGUubWFwcy5EaXN0YW5jZU1hdHJpeFNlcnZpY2UoKTtcbiAgICBzZXJ2aWNlLmdldERpc3RhbmNlTWF0cml4KHtcbiAgICAgIG9yaWdpbnM6IFtvcmlnaW5dLFxuICAgICAgZGVzdGluYXRpb25zOiBbZGVzdGluYXRpb25dLFxuICAgICAgdHJhdmVsTW9kZTogZ29vZ2xlLm1hcHMuVHJhdmVsTW9kZS5EUklWSU5HLH0sXG4gICAgICBmdW5jdGlvbihyZXNwb25zZSwgc3RhdHVzKSB7XG4gICAgICAgIGlmIChzdGF0dXMgPT0gZ29vZ2xlLm1hcHMuRGlzdGFuY2VNYXRyaXhTdGF0dXMuT0spIHtcbiAgICAgICAgICBsZXQgZGlzdGFuY2VtYXRyaXggPSByZXNwb25zZS5yb3dzWzBdLmVsZW1lbnRzWzBdO1xuICAgICAgICAgIGlmIChkaXN0YW5jZW1hdHJpeC5zdGF0dXMgPT0gZ29vZ2xlLm1hcHMuRGlzdGFuY2VNYXRyaXhTdGF0dXMuT0spIHtcbiAgICAgICAgICAgIHNlbGYuZm9ybS5ldmVudGxvY2F0aW9uZGlzdGFuY2UoZGlzdGFuY2VtYXRyaXguZGlzdGFuY2UudmFsdWUpO1xuICAgICAgICAgICAgc2VsZi5hZGRyZXNzTm90Rm91bmQoZmFsc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG5cbiAgfVxuICBpbml0R29vZ2xlU2VhcmNoKCkge1xuICAgIC8vIFdlIGNhbGwgdGhpcyBmdW5jaXRvbiBmcm9tIG91dHNpZGUuIFNvIHdlIGhhdmUgdG8gc2V0IFxuICAgIC8vIHRoZSB3aXphcmQgaXRzZWxmIHRvIGJlIGFibGUgdG8gYWNjZXNzIGl0cyBmdW5jdGlvbnMuXG4gICAgbGV0IHNlbGYgPSB3aW5kb3cud2l6YXJkO1xuICAgIGpRdWVyeSh3aW5kb3cpLm9uKCdsb2FkJywgZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXZlbnRsb2NhdGlvbicpO1xuICAgICAgdmFyIHNlYXJjaEJveCA9IG5ldyBnb29nbGUubWFwcy5wbGFjZXMuU2VhcmNoQm94KGlucHV0KTtcbiAgICAgIHNlYXJjaEJveC5hZGRMaXN0ZW5lcigncGxhY2VzX2NoYW5nZWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgc2VsZi5jYWxjdWxhdGVEaXN0YW5jZShzZWFyY2hCb3guZ2V0UGxhY2VzKClbMF0pO1xuICAgICAgfSk7XG4gICAgICBnb29nbGUubWFwcy5ldmVudC5hZGREb21MaXN0ZW5lcihpbnB1dCwgJ2tleWRvd24nLCBmdW5jdGlvbihlKSB7IFxuICAgICAgICBpZiAoZS5rZXlDb2RlID09IDEzKSB7IFxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOyBcbiAgICAgICAgfVxuICAgICAgfSk7IFxuICAgIH0pO1xuICB9O1xufVxuXG53aW5kb3cud2l6YXJkID0gbmV3IFdpemFyZCgpO1xudmFyIGluaXRHb29nbGVTZWFyY2ggPSB3aW5kb3cud2l6YXJkLmluaXRHb29nbGVTZWFyY2g7XG5cbmpRdWVyeSh3aW5kb3cpLm9uKCdsb2FkJywgZnVuY3Rpb24oKSB7XG4gIGtvLmFwcGx5QmluZGluZ3Mod2luZG93LndpemFyZCwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dpemFyZC1mb3JtJykpO1xufSk7XG4iXX0=
